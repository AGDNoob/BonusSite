<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CWL Bonus – Rangliste</title>
  <style>
    :root{
      --bg:#0b0f17; --card:#101826; --text:#eaf0ff; --muted:#a9b4cc;
      --line:rgba(255,255,255,.10); --accent:#0a84ff; --gold:#f5c542; --silver:#c7d2e3; --bronze:#d08c5a;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;background:radial-gradient(1200px 700px at 10% 10%, #142044 0%, var(--bg) 55%);color:var(--text);min-height:100vh}
    .wrap{max-width:1200px;margin:0 auto;padding:20px 16px}
    .header{display:flex;gap:12px;align-items:flex-start;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap}
    .title{font-size:clamp(20px,5vw,26px);font-weight:800;letter-spacing:.2px;line-height:1.2}
    .subtitle{color:var(--muted);font-size:clamp(11px,3vw,13px);margin-top:6px;line-height:1.4}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));border:1px solid var(--line);border-radius:16px;overflow:hidden;box-shadow:0 12px 40px rgba(0,0,0,.3)}
    .table-container{overflow-x:auto;-webkit-overflow-scrolling:touch}
    table{width:100%;border-collapse:separate;border-spacing:0;min-width:500px}
    thead th{font-size:clamp(10px,2.5vw,12px);text-transform:uppercase;letter-spacing:.12em;color:var(--muted);text-align:left;padding:14px 12px;background:rgba(255,255,255,.02);border-bottom:1px solid var(--line);white-space:nowrap}
    tbody td{padding:14px 12px;border-bottom:1px solid var(--line);vertical-align:middle;font-size:clamp(13px,3.5vw,15px)}
    tbody tr:last-child td{border-bottom:none}
    tbody tr:hover{background:rgba(255,255,255,.03)}
    .rank{width:70px;font-weight:800}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:rgba(255,255,255,.02);font-size:clamp(10px,2.5vw,12px);color:var(--muted);white-space:nowrap}
    .dot{width:8px;height:8px;border-radius:50%;background:var(--accent)}
    .points{font-variant-numeric:tabular-nums;font-weight:800}
    .attacks{font-variant-numeric:tabular-nums;color:var(--muted);white-space:nowrap}
    .badge{display:inline-flex;align-items:center;justify-content:center;min-width:32px;height:32px;border-radius:10px;font-weight:900;color:#0b0f17;font-size:clamp(13px,3.5vw,15px)}
    .b1{background:var(--gold)} .b2{background:var(--silver)} .b3{background:var(--bronze)}
    .name{font-weight:750;word-break:break-word}
    .note{padding:14px 12px;color:var(--muted);font-size:clamp(10px,2.5vw,12px);border-top:1px solid var(--line);line-height:1.5}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    .side{display:flex;flex-direction:column;gap:12px}
    .side .box{padding:16px;border-radius:16px;border:1px solid var(--line);background:rgba(255,255,255,.02)}
    .side h3{margin:0 0 10px;font-size:clamp(11px,3vw,13px);color:var(--muted);text-transform:uppercase;letter-spacing:.12em}
    .side .big{font-size:clamp(20px,5vw,24px);font-weight:900;word-break:break-word}
    .side .small{color:var(--muted);font-size:clamp(11px,3vw,12px);line-height:1.6}
    .controls{display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap}
    .search-box,.month-select{padding:12px 14px;border-radius:12px;border:1px solid var(--line);background:rgba(255,255,255,.04);color:var(--text);font-size:clamp(13px,3.5vw,14px);outline:none;transition:all .2s;-webkit-appearance:none;appearance:none}
    .search-box{flex:1;min-width:200px;padding-left:40px;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23a9b4cc'%3E%3Cpath d='M11.7 10.3l3.6 3.6-1.4 1.4-3.6-3.6A6 6 0 1112 6a6 6 0 01-.3 4.3zM6 10a4 4 0 100-8 4 4 0 000 8z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:12px center;background-size:16px}
    .search-box:focus{border-color:var(--accent);background-color:rgba(10,132,255,.08);box-shadow:0 0 0 3px rgba(10,132,255,.12)}
    .month-dropdown{position:relative;min-width:180px}
    .month-btn{width:100%;padding:12px 14px;padding-left:40px;padding-right:36px;border-radius:12px;border:1px solid var(--line);background:rgba(255,255,255,.04);color:var(--text);font-size:clamp(13px,3.5vw,14px);cursor:pointer;text-align:left;transition:all .2s;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23a9b4cc'%3E%3Crect x='3' y='4' width='10' height='10' rx='1' stroke='%23a9b4cc' fill='none'/%3E%3Cpath d='M5 2v3M11 2v3M3 7h10'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:12px center;background-size:16px}
    .month-btn::after{content:'';position:absolute;right:14px;top:50%;transform:translateY(-50%);border:5px solid transparent;border-top-color:var(--muted);transition:transform .2s}
    .month-dropdown.open .month-btn::after{transform:translateY(-50%) rotate(180deg)}
    .month-btn:hover{background-color:rgba(255,255,255,.06)}
    .month-list{position:absolute;top:calc(100% + 6px);left:0;right:0;background:var(--card);border:1px solid var(--line);border-radius:12px;overflow:hidden;opacity:0;visibility:hidden;transform:translateY(-8px);transition:all .2s;z-index:100;box-shadow:0 8px 32px rgba(0,0,0,.4)}
    .month-dropdown.open .month-list{opacity:1;visibility:visible;transform:translateY(0)}
    .month-option{padding:12px 16px;cursor:pointer;transition:background .15s;color:var(--text);font-size:14px}
    .month-option:hover{background:rgba(255,255,255,.06)}
    .month-option.active{background:rgba(10,132,255,.15);color:var(--accent)}
    .highlight{background:rgba(10,132,255,.20)!important;animation:pulse .6s ease-out}
    @keyframes pulse{0%,100%{background:rgba(10,132,255,.20)} 50%{background:rgba(10,132,255,.35)}}
    .no-results{padding:40px 20px;text-align:center;color:var(--muted);font-size:clamp(12px,3.5vw,14px)}
    .skeleton{background:linear-gradient(90deg,rgba(255,255,255,.04) 25%,rgba(255,255,255,.08) 50%,rgba(255,255,255,.04) 75%);background-size:200% 100%;animation:shimmer 1.5s infinite}
    @keyframes shimmer{0%{background-position:200% 0} 100%{background-position:-200% 0}}
    .skeleton-row{height:52px}
    tbody tr{transition:all .2s ease}
    .fade-in{opacity:0;animation:fadeIn .3s ease forwards}
    @keyframes fadeIn{to{opacity:1}}
    .stats-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:10px;margin-bottom:16px}
    .stat-card{padding:14px 12px;border-radius:12px;border:1px solid var(--line);background:rgba(255,255,255,.02);text-align:center}
    .stat-value{font-size:clamp(18px,5vw,22px);font-weight:900;color:var(--accent)}
    .stat-label{font-size:clamp(9px,2.5vw,11px);color:var(--muted);text-transform:uppercase;letter-spacing:.1em;margin-top:6px;line-height:1.2}
    .badge{transition:transform .2s ease}
    tbody tr:hover .badge{transform:scale(1.15)}
    .credits{text-align:center;padding:32px 16px;color:var(--muted);font-size:clamp(12px,3vw,14px);margin-top:24px}
    .credits strong{color:var(--text);font-weight:600}
    
    /* Icons */
    .icon{display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;vertical-align:middle}
    .icon-check{color:#34c759}
    .icon-search{color:var(--muted)}
    .icon-error{color:#ff453a}
    .icon svg{width:100%;height:100%;fill:currentColor}
    
    /* Enhanced Animations */
    .wrap{animation:fadeSlideIn .5s ease}
    @keyframes fadeSlideIn{from{opacity:0;transform:translateY(12px)} to{opacity:1;transform:translateY(0)}}
    .card{transition:transform .2s ease,box-shadow .2s ease}
    .card:hover{transform:translateY(-2px);box-shadow:0 16px 48px rgba(0,0,0,.4)}
    .side .box{transition:transform .2s ease,border-color .2s ease}
    .side .box:hover{transform:translateY(-2px);border-color:rgba(255,255,255,.18)}
    .stat-card{transition:transform .2s ease,border-color .2s ease}
    .stat-card:hover{transform:translateY(-3px);border-color:var(--accent)}
    .stat-value{transition:color .2s ease}
    .stat-card:hover .stat-value{color:#fff}
    tbody tr{opacity:0;animation:rowFadeIn .3s ease forwards}
    @keyframes rowFadeIn{to{opacity:1}}
    .pill{transition:background .2s ease,border-color .2s ease}
    .pill:hover{background:rgba(255,255,255,.04);border-color:rgba(255,255,255,.18)}
    .dot{animation:pulse-dot 2s ease-in-out infinite}
    @keyframes pulse-dot{0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.6;transform:scale(.85)}}
    .title{background:linear-gradient(135deg,var(--text) 0%,var(--accent) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .search-box{transition:all .25s cubic-bezier(.4,0,.2,1)}
    .search-box:focus{transform:scale(1.01)}
    
    @media (min-width: 640px){
      .wrap{padding:28px 20px}
      .header{margin-bottom:24px}
      .controls{margin-bottom:20px}
      .stats-row{margin-bottom:20px}
    }
    
    @media (min-width: 960px){
      .wrap{padding:32px 24px}
      .grid{grid-template-columns:1.4fr 1fr}
      .header{margin-bottom:28px}
      tbody td{padding:14px 16px}
      thead th{padding:14px 16px}
      .card{border-radius:18px}
      .side .box{border-radius:18px}
    }
    
    @media (hover: none) and (pointer: coarse){
      .search-box,.month-select{padding:14px 14px 14px 40px;font-size:16px}
      tbody td{padding:16px 12px}
      .badge{min-width:36px;height:36px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div>
        <div class="title">CWL Bonus – Rangliste</div>
        <div class="subtitle">Accounts werden einzeln gewertet • +5 Bonus nur bei exakt 7 Angriffen</div>
      </div>
      <span class="pill"><span class="dot"></span> <span id="status">Lädt...</span></span>
    </div>

    <div class="controls">
      <input type="text" class="search-box" id="searchBox" placeholder="Spielername suchen..." />
      <div class="month-dropdown" id="monthDropdown">
        <button class="month-btn" id="monthBtn">Februar 2026</button>
        <div class="month-list" id="monthList">
          <div class="month-option active" data-value="2026-02">Februar 2026</div>
          <div class="month-option" data-value="2026-01">Januar 2026</div>
        </div>
      </div>
    </div>

    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-value" id="totalPlayers">—</div>
        <div class="stat-label">Spieler</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="avgPoints">—</div>
        <div class="stat-label">Ø Punkte</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="bonusCount">—</div>
        <div class="stat-label">7/7 Angriffe</div>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="table-container">
        <table>
          <thead>
            <tr>
              <th class="rank">Rang</th>
              <th>Spieler</th>
              <th style="width:140px;">Punkte</th>
              <th style="width:120px;">Angriffe</th>
            </tr>
          </thead>
          <tbody id="tableBody">
          </tbody>
        </table>
        </div>
        <div class="note">Punkte: Sterne (0/5/10/20) + 0.1×% + RH-Diff (up: +3/RH, down: −2/RH) • Bonus: +5 bei 7/7 Angriffen</div>
      </div>

      <div class="side">
        <div class="box">
          <h3>Top 1</h3>
          <div class="big" id="top1Name">—</div>
          <div class="small" id="top1Stats">—</div>
        </div>
        <div class="box">
          <h3>Top 3</h3>
          <div class="small" id="top3Line1">—</div>
          <div class="small" id="top3Line2">—</div>
          <div class="small" id="top3Line3">—</div>
        </div>
        <div class="box">
          <h3>Hinweis</h3>
          <div class="small">Zweitaccounts werden NICHT zusammengelegt. Jeder Account zählt einzeln.</div>
        </div>
      </div>
    </div>
    
    <div class="credits">
      Seite, Daten und Berechnungen von <strong>AGDNoob</strong> &lt;3
    </div>
  </div>

  <script>
    let allData = [];
    let currentData = [];

    async function loadMonth(month) {
      document.getElementById('tableBody').innerHTML = '<tr class="skeleton"><td colspan="4"><div class="skeleton-row"></div></td></tr>'.repeat(5);
      
      try {
        const response = await fetch(`data/${month}.json`);
        if (!response.ok) throw new Error('Monat nicht gefunden');
        const data = await response.json();
        allData = data.players;
        currentData = [...allData];
        document.getElementById('status').textContent = data.month;
        renderTable();
        updateSidebar();
        updateStats();
      } catch (error) {
        document.getElementById('status').textContent = 'Fehler beim Laden';
        document.getElementById('tableBody').innerHTML = '<tr><td colspan="4" class="no-results"><span class="icon icon-error"><svg viewBox="0 0 20 20"><path d="M10 0C4.48 0 0 4.48 0 10s4.48 10 10 10 10-4.48 10-10S15.52 0 10 0zm1 15H9v-2h2v2zm0-4H9V5h2v6z"/></svg></span> Fehler beim Laden der Daten</td></tr>';
        console.error(error);
      }
    }

    function renderTable(searchTerm = '') {
      const tbody = document.getElementById('tableBody');
      const filtered = searchTerm 
        ? allData.filter(p => p.name.toLowerCase().includes(searchTerm.toLowerCase()))
        : allData;

      console.log('Search term:', searchTerm);
      console.log('Filtered players:', filtered.length);
      console.log('Sample data:', filtered[0]);

      if (filtered.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="no-results">Keine Spieler gefunden <span class="icon icon-search"><svg viewBox="0 0 20 20"><path d="M12.9 14.32a8 8 0 1 1 1.41-1.41l5.35 5.33-1.42 1.42-5.33-5.34zM8 14A6 6 0 1 0 8 2a6 6 0 0 0 0 12z"/></svg></span></td></tr>';
        return;
      }

      const html = filtered.map((p, idx) => {
        const badge = p.rank <= 3 
          ? `<span class="badge b${p.rank}">${p.rank}</span>`
          : p.rank;
        const checkIcon = '<span class="icon icon-check"><svg viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/></svg></span>';
        const attacks = p.bonus ? `${p.attacks} ${checkIcon}` : p.attacks;
        const highlightClass = searchTerm && p.name.toLowerCase().includes(searchTerm.toLowerCase()) 
          ? 'highlight' 
          : '';
        
        return `<tr class="${highlightClass}" style="animation-delay:${idx * 0.03}s">
          <td class="rank">${badge}</td>
          <td class="name">${p.name}</td>
          <td class="points">${p.points}</td>
          <td class="attacks">${attacks}</td>
        </tr>`;
      }).join('');
      
      console.log('HTML length:', html.length);
      tbody.innerHTML = html;
    }

    function updateSidebar() {
      if (currentData.length === 0) return;

      const top1 = currentData[0];
      document.getElementById('top1Name').textContent = top1.name;
      document.getElementById('top1Stats').textContent = `${top1.points} Punkte • ${top1.attacks}/7`;

      const top3 = currentData.slice(0, 3);
      document.getElementById('top3Line1').textContent = top3[0] ? `1) ${top3[0].name} — ${top3[0].points}` : '—';
      document.getElementById('top3Line2').textContent = top3[1] ? `2) ${top3[1].name} — ${top3[1].points}` : '—';
      document.getElementById('top3Line3').textContent = top3[2] ? `3) ${top3[2].name} — ${top3[2].points}` : '—';
    }

    function updateStats(data = allData) {
      const total = data.length;
      const avgPoints = total ? Math.round(data.reduce((sum, p) => sum + p.points, 0) / total) : 0;
      const bonusCount = data.filter(p => p.bonus).length;
      
      document.getElementById('totalPlayers').textContent = total;
      document.getElementById('avgPoints').textContent = avgPoints;
      document.getElementById('bonusCount').textContent = `${bonusCount}/${total}`;
    }

    document.getElementById('searchBox').addEventListener('input', (e) => {
      const searchTerm = e.target.value.trim();
      renderTable(searchTerm);
      const filtered = searchTerm 
        ? allData.filter(p => p.name.toLowerCase().includes(searchTerm.toLowerCase()))
        : allData;
      updateStats(filtered);
    });

    // Custom Dropdown
    const dropdown = document.getElementById('monthDropdown');
    const monthBtn = document.getElementById('monthBtn');
    const monthList = document.getElementById('monthList');

    monthBtn.addEventListener('click', () => {
      dropdown.classList.toggle('open');
    });

    monthList.addEventListener('click', (e) => {
      const option = e.target.closest('.month-option');
      if (!option) return;
      
      monthList.querySelectorAll('.month-option').forEach(o => o.classList.remove('active'));
      option.classList.add('active');
      monthBtn.textContent = option.textContent;
      dropdown.classList.remove('open');
      loadMonth(option.dataset.value);
    });

    document.addEventListener('click', (e) => {
      if (!dropdown.contains(e.target)) {
        dropdown.classList.remove('open');
      }
    });

    // Initial load
    loadMonth('2026-02');
  </script>
</body>
</html>
